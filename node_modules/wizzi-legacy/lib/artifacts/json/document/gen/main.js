var lineparser = require('wizzi-core').lineparser;
var md = module.exports = {};
var myname = 'json.document.main';

md.gen = function (model, ctx) {
    var n = model.n.trim();
    if (model.childs.length > 0) {
        if (n === '{' || n === '[') {
            ctx.w(n);
            md.go(model, ctx, n);
        } else {
            // must be an object preperty
            ctx.w('"' + model.n + '":');
            md.go(model, ctx);
        }
        if (n === '{') {
            ctx.write('}');
        } else if (n === '[') {
            ctx.write(']');
        }
    } else {
        if (n === '{') {
            ctx.w('{}');
        } else if (n === '[') {
            ctx.w('[]');
        } else {
            if (model.parent === '{')
                if (model.n === '@') {
                    var nv = lineparser.parseNameValue(model.v)
                    ctx.write('"' + nv.name() + '": ' + nv.value());
                } else {
                    ctx.write('"' + model.n + '": ' + model.v);
                }
            else
                ctx.write(model.n); // array element
        }
    }
}
md.go = function (model, ctx, parent) {
    ctx.indent();
    var first = true;
    model.childs.forEach(function (item) {
        if (!first) ctx.w(',');
        first = false;
        if (parent) item.parent = parent;
        md.gen(item, ctx);
    });
    ctx.w('');
    ctx.deindent();
}
