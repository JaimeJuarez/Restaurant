var verify = require('wizzi-core').verify;
var error = require('wizzi-core').error;

var types = module.exports = {};

types.objectify = function (value, type, node, unquote) {
    if (value === '@@null') return null;
    if (value === '@@undefined') return undefined;
    var isTemplate = types.isTemplate(value);
    if (isTemplate) {
        return value;
    }
    if (type == null || typeof type === 'undefined' || type == 'string') {
        if (verify.isString(value)) {
            if (unquote)
                return verify.unquote(value); // calle from getArgValues
            else
                return value;
        }
        else return '';
    } else if (type == 'int') {
        if (isNaN(value) == false) return parseInt(value, 10);
        else throw error.NodeError('types.objectify. Cannot convert ' + value + ' to int', node);
    }
    else if (type == 'float') {
        if (isNaN(value) == false) return parseFloat(value);
        else throw error.NodeError('types.objectify. Cannot convert ' + value + ' to float', node);
    }
    else if (type == 'bool') {
        if (types.isBool(value)) return types.parseBool(value);
        else throw error.NodeError('types.objectify. Cannot convert ' + value + ' to bool', node);
    }
    else if (type == 'date') {
        if (types.isDate(value)) return types.parseDate(value);
        else throw error.NodeError('types.objectify. Cannot convert ' + value + ' to date', node);
    }
    var msg = 'Invalid type name, expected (string, int, float, bool, date) got ' + type;
    throw error.NodeError(msg, node);
}

types.isTemplate = function (obj) {
    if (types.isString(obj) === false) return false;
    return obj.substr(0,2) === '${' && obj.substr(-1,1) === '}';
}

types.isDefined = function (obj) {
    return !(typeof obj === 'undefined');
}

types.isObject = function (obj) {
    return obj !== null && typeof obj === 'object';
}

types.isString = function (obj) {
    return obj !== null && typeof obj === 'string';
}

types.isBool = function (obj) {
    if (types.isString(obj)) return obj === 'true' || obj === 'false';
    return typeof obj === "boolean";
}

types.isDate = function (obj) {
    var parts = input.split('/');
    return parts.length == 3;
}

types.parseBool = function (obj) {
    return obj === 'true' ? true : false;
}

types.parseDate = function (obj) {
    var parts = input.split('-');
    // new Date(year, month [, day [, hours[, minutes[, seconds[, ms]]]]])
    return new Date(parts[0], parts[1] - 1, parts[2]); // Note: months are 0-based
}


