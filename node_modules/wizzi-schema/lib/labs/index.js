// generator: wizzi-lab-artifatcs/lib/js/module/gen/main.js, utc time: Thu, 22 Oct 2015 19:39:43 GMT

var util = require('util');
var path = require('path');
var stringify = require('json-stringify-safe');
var file = require('wizzi-core').file;
var WizziSchema = require('../../lib/wizzimodels/bootstrap/wizzischema-model').WizziSchema;
var index = require('../../index');

var s_rdbms_path = path.join(__dirname, 'ittf', 'rdbms.wizzischema.ittf');
var s_rdbms_out_json_path = path.join(__dirname, 'out', 'rdbms.wizzimodel.json');
var s_rdbms_out_model_path = path.join(__dirname, 'out', 'rdbms.wizzimodel.js');

var s_wizzischema_path = path.join(__dirname, 'ittf', 'wizzischema.wizzischema.ittf');
var s_wizzimodel_out_json_path = path.join(__dirname, 'out', 'wizzischema.wizzimodel.json');
var s_wizzimodel_out_model_path = path.join(__dirname, 'out', 'wizzischema.wizzimodel.js');

generate(s_rdbms_path, s_rdbms_out_json_path, s_rdbms_out_model_path);

generate(s_wizzischema_path, s_wizzimodel_out_json_path, s_wizzimodel_out_model_path);

function generate(ittfDocumentPath, outjsonpath, outmodelpath) {
    index.wizzischema(ittfDocumentPath, {}, function(err, wizziModelTemp) {
        if (err) {
            throw new Error('Wizzi-schema.lab.index.generate: ' + util.inspect(err));
        }
        // load the wizziModelTemp instance into the bootstrap wizzimodel.
        // This is required until the generation of the WizziModel of type 'wizzischema'
        // is not completely automated.
        var bootWizziModel = new WizziSchema(wizziModelTemp.wzName);
        bootWizziModel.loadFromWizziModel(wizziModelTemp);
        file.write(outjsonpath, stringify(bootWizziModel, null, 2));
    });
    index.generateWizzischemaModelAndLoader(ittfDocumentPath, {}, function(err, wizziModelAndLoaderArtifact) {
        if (err) {
            throw new Error('Wizzi-schema.lab.index.generateWizzischemaModel: ' + util.inspect(err));
        }
        file.write(outmodelpath, wizziModelAndLoaderArtifact[0]);
    });
}
